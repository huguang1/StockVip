function Stock(){this.category_a=$(".tab_hda").find("li").first().attr("data-category"),this.category_b=$(".tab_hd").find("li").first().attr("data-category"),this.username="",this.sellingShares=0}Stock.prototype.getAssetDataEvent=function(m,e){var _=this;stockajax.get({url:"/mosaic/assetsone/",data:{username:m,category:e},success:function(e){if(200===e.code){var t=e.data,a=t.total_assets,s=t.residual_assets,n=t.holding_shares,r=t.buying_shares,o=t.selling_shares;_.sellingShares=parseInt(o);var i=t.today_price,c=t.yesterday_price,l=t.personal_gain,u=t.sell_count;$(".username_mark").html("尊敬的: "+t.username),$("#user_total_bet").html(a),$("#dz_first-total_assets").html(a),$("#user_valid_bet").html(s),$("#dz_first-residual_assets").html(s),$("#user_hold_shares").html(n),$("#dz_first-holding_shares").html(n),$("#user_buy_shares").html(r),$("#dz_first-buying_shares").html(r),$("#user_sell_shares").html(Number(r)-Number(n)),$("#dz_first-selling_shares").html(Number(r)-Number(n)),$("#user_free_shares").html(u),$("#dz_first-today-price").html(i),$("#user_auth_price").html(i),$("#dz_first-yesterday-price").html(c),$("#dz_first-username").html(m),$("#user_person_price").html(l),$("#dz_first-gain").html(l);var h=(Number(l)+Number(i))*Number(o);$("#dz_first-exchange").html(h),$("#calc_lottery").html(h),$("#dz_first-can_sold").html(u),$("#sell_shares").val(u),$("#buy_shares").val(parseInt(Number(s)/1e4))}}})},Stock.prototype.tabUserEvent=function(){var e=this;$(".tab_hda").children().click(function(){$(this).addClass("on").siblings().removeClass("on"),e.category_a=$(this).attr("data-category"),e.getAssetDataEvent(e.username,e.category_a)})},Stock.prototype.checkLoginEvent=function(){var n=this;stockajax.get({url:"/login/",data:{category:n.category_a},success:function(e){if(200===e.code){var t=$(".tourist_area"),a=$(".userinfo_area");if(e.data.is_login){t.hide(),a.show();var s=e.data.username;n.username=s,n.tabUserEvent(),$(".dz_first").show(),$(".dz_two").show(),$(".dz_tip").show(),$(".dz_three").hide(),$(".tab_bda").children().eq(0).show(),n.getAssetDataEvent(s,n.category_a)}else t.show(),a.hide(),$(".dz_first").hide(),$(".dz_two").hide(),$(".dz_tip").hide()}}})},Stock.prototype.buyStockEvent=function(){var t=this;$("#btnMaiRu").click(function(){var e=parseInt($("#buy_shares").val());e<=parseInt($("#user_valid_bet").text())/1e4&&0<e?e&&t.category_a&&t.username?stockajax.post({url:"/mosaic/buydtl/",data:{user:t.username,count:e,category:t.category_a},success:function(e){200===e.code&&layer.msg("交易成功",{icon:1,time:1e3},function(){t.getAssetDataEvent(t.username,t.category_a)})}}):layer.msg("请输入购买数量",{icon:2,time:1e3}):layer.msg("资产不足",{icon:2,time:1e3})})},Stock.prototype.sellStockEvent=function(){var s=this;$("#btnMaiChu").click(function(){var e=$("#sell_shares").val(),t=$("#user_hold_shares").text(),a=parseInt($("#user_free_shares").text());parseInt(e)>parseInt(t)||parseInt(e)>a?layer.msg("您当前只能卖出: "+a+" 股",{icon:2,time:1e3}):e&&s.category_a&&s.username&&0!==parseInt(e)?stockajax.post({url:"/mosaic/selldtl/",data:{user:s.username,count:e,category:s.category_a},success:function(e){200===e.code&&layer.msg("交易成功",{icon:1,time:1e3},function(){s.getAssetDataEvent(s.username,s.category_a)})}}):layer.msg("请输入卖出股票的数量",{icon:2,time:1e3})})},Stock.prototype.redemptionEvent=function(){var t=this;$("#receive_gold").bind("click",function(){t.category_a&&t.username&&0!==t.sellingShares&&stockajax.post({url:"/mosaic/receiptdtl/",data:{user:t.username,category:t.category_a},success:function(e){200===e.code&&layer.msg("彩金兑换成功!",{icon:1,time:1e3},function(){t.getAssetDataEvent(t.username,t.category_a)})}})})},Stock.prototype.loginEvent=function(){var s=this;$("#btnLogin").bind("click",function(){var t=$("#username").val(),e=$("#verycode").val().toLowerCase(),a=$(".yancode input").val().toLowerCase();return e.length<4||a!==e||a.length<4?(layer.msg("验证码不正确!",{icon:2,time:1e3}),null):t?void stockajax.post({url:"/login/",data:{username:t,category:s.category_a},success:function(e){200===e.code&&($(".tanshow").hide(),$(".tourist_area").hide(),$(".userinfo_area").show(),s.username=t,s.checkLoginEvent(),layer.msg("登录成功!",{icon:1,time:1e3}))}}):(layer.msg("请输入用户名",{icon:2,time:1e3}),null)})},Stock.prototype.logoutEvent=function(){$("#loginout").click(function(){stockajax.get({url:"/logout/",success:function(e){200===e.code&&layer.msg("登出成功",{icon:1,time:1e3},function(){window.location=window.location.href})}})})},Stock.prototype.simulationCalculationEvent=function(){$("#jisuan").click(function(){var e=$("#total").val(),t=$("#price").val(),a=$("#sell").val(),s=$("#bet").val(),n=/^\d+$/;if(!n.test(e)||!e)return layer.msg("请输入正确的截止昨日拥有股票总数",{time:1e3,icon:0}),!1;if(!n.test(s)||!s)return layer.msg("请输入正确的昨日投注数量",{time:1e3,icon:0}),!1;if(!n.test(t)&&!/^\d+(\.\d+)?$/.test(t)||!t)return layer.msg("请输入正确的官方股价，如8.8",{time:1e3,icon:0}),!1;if(!n.test(a)||!a)return layer.msg("请输入正确的卖出股票数量",{time:1e3,icon:0}),!1;if(5e7<s)return layer.msg("请输入正确的少于5000000万的投注",{time:1e3,icon:0}),!1;if(parseInt(a)>parseInt(e))return layer.msg("卖出数量不可大于截止昨日拥有总数",{time:1e3,icon:0}),!1;var r="";0===s&&(r=-2),0<s<=1e4&&(r=0),s<5e4&&1e4<=s&&(r=.1),s<1e5&&5e4<=s&&(r=.5),s<5e5&&1e5<=s&&(r=.8),s<1e6&&5e5<=s&&(r=1),s<5e6&&1e6<=s&&(r=1.2),s<1e7&&5e6<=s&&(r=1.3),s<5e7&&1e7<=s&&(r=2),5e7<=s&&(r=5);var o=parseInt(a)*(parseInt(r)+parseInt(t));$("#lottery").val(o)})},Stock.prototype.getOnlineUsers=function(){stockajax.get({url:"/mosaic/count/",data:{l:Math.ceil(1e6*Math.random())},success:function(e){if(200===e.code){var t=e.data.online_count,a="";if(t){var s=t.toString().split("");a="已有",$.each(s,function(e,t){a+="<span>"+t+"</span>"}),a+="名客户",$(".footer_vip_num").html(a)}else a="已有<span>8</span><span>0</span><span>0</span>名客户",$(".footer_vip_num").html(a)}}})},Stock.prototype.updateOnlineUsers=function(){var e=this;setInterval(function(){e.getOnlineUsers()},6e5)},Stock.prototype.run=function(){this.getOnlineUsers(),this.checkLoginEvent(),this.loginEvent(),this.logoutEvent(),this.tabUserEvent(),this.buyStockEvent(),this.sellStockEvent(),this.redemptionEvent(),this.simulationCalculationEvent(),this.updateOnlineUsers()},$(function(){(new Stock).run()});