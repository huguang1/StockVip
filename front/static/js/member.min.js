function MemberImport(){this.filename="",this.btnCalc=$("#btn_calc"),this.btnCalc.addClass("disabled"),this.iptAddTime=$("#ipt_add_time"),this.categorySelect=$("#category-select")}function MemberUpdate(){}function MemberInfo(){this.queryDate="",this.queryUser=""}MemberImport.prototype.importDatabaseEvent=function(){var a=this;a.btnCalc.click(function(){layer.msg("数据正在导入",{icon:16,time:3e4});var e=a.iptAddTime.val(),t=a.categorySelect.val();if(""===e)return layer.msg("请先选择数据的导入日期!",{icon:5,time:1e3}),null;stockajax.post({url:"/member/import/",data:{ipt_time:e,filename:a.filename,category:t},success:function(e){200===e.code&&(layer.closeAll(),layer.msg("数据导入成功!",{icon:1,time:1e3},function(){window.location.href="/member/info/"}))}})})},MemberImport.prototype.uploadFileEvent=function(){var n=this;function o(e){var t=e.loaded,a=e.total,n=Math.round(t/a*100)+"%";$("#sr-only").css({width:n}),$(".percent").html(n)}$("#fileupload").change(function(){if(""===n.iptAddTime.val())return layer.msg("请先选择数据的导入日期!",{icon:5,time:1e3}),!1;if(""===n.categorySelect.val())return layer.msg("请先选择数据的导入类型!",{icon:5,time:1e3}),!1;var e=this.files[0],t=e.name.split(".").pop().toLowerCase();if("xls"===t||"xlsx"===t){var a=new FormData;a.append("file",e),stockajax.post({url:"/member/upload_file/",data:a,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",o,!1),e},success:function(e){200===e.code&&(n.filename=e.data.name,$("#result").text("上传成功"),n.btnCalc.removeClass("disabled"))}})}else layer.msg("必须是excel文件，后缀名为xls或者xlsx",{icon:2,time:1e3},function(){window.location.reload()})})},MemberImport.prototype.run=function(){this.importDatabaseEvent(),this.uploadFileEvent()},MemberUpdate.prototype.updateMember=function(){$(".update-member-data-btn").click(function(){var e=$(this).parent("td.td-manage"),t=e.prevAll(".update-id").text(),a=e.prevAll(".update-member_date").attr("data-date"),n=e.prevAll(".td-status").attr("data-is-member");if("True"===n)return null;layer.confirm("确定要更新？",{btn:["确定","取消"]},function(){t&&a&&"False"===n?(layer.msg("正在更新.....",{icon:16,time:1e8}),stockajax.post({url:"/member/update/",data:{update_id:t,date:a},success:function(e){200===e.code&&(layer.closeAll(),layer.msg("更新成功!",{icon:1,time:1e3},function(){window.location=window.location.href}))}})):(layer.closeAll(),layer.msg("更新失败!",{icon:2,time:1e3},function(){layer.closeAll()}))},function(){layer.closeAll()})})},MemberUpdate.prototype.deleteMemberData=function(){$(".del-member-data-btn").click(function(){var e=$(this).parent("td.td-manage"),t=e.prevAll(".update-id").text(),a=e.prevAll(".update-member_date").attr("data-date"),n=e.prevAll(".update-category").attr("data-category");layer.confirm("确定要删除？",{btn:["确定","取消"]},function(){t&&a?stockajax.delete({url:"/member/update/",data:{update_id:t,date:a,update_category:n},success:function(e){200===e.code&&(layer.closeAll(),layer.msg("删除成功!",{icon:1,time:1e3},function(){window.location=window.location.href}))}}):(layer.closeAll(),layer.msg("删除失败!",{icon:2,time:1e3},function(){layer.closeAll()}))},function(){layer.closeAll()})})},MemberUpdate.prototype.run=function(){this.updateMember(),this.deleteMemberData()},MemberInfo.prototype.addMembeInfoEvent=function(){var o=$("#info-category-select"),i=$("#info-user"),r=$("#info-amount"),l=$("#info-add_time");$("#membe-info-btnAdd").click(function(){o.val(),i.val(),r.val(),l.val(),layer.open({type:1,title:"添加打码信息",closeBtn:1,anim:2,area:["800px","400px"],shadeClose:!0,content:$("#add-info-tan")})}),$("#add-info-submit-btn").click(function(){var e=o.val(),t=i.val(),a=r.val(),n=l.val();a&&t&&e&&n?(layer.closeAll(),stockajax.post({url:"/member/info/",data:{category:e,username:t,amount:a,add_date:n},success:function(e){200===e.code&&layer.msg("添加打码信息成功",{icon:1,time:1e3},function(){window.location=window.location.href})}})):layer.msg("请正确填写打码信息",{icon:2,time:1e3})})},MemberInfo.prototype.inquireBtnEvent=function(){var l=this;$("#info-btnQuery").click(function(){l.queryDate=$("#ipt_add_time").val(),l.queryUser=$("#info-user_name").val(),stockajax.get({url:"/member/infolist/",data:{username:l.queryUser,date:l.queryDate},success:function(e){if(200===e.code){var t=e.data,a=template("info-item",{data:t.data}),n=$(".info-tbody");n.empty(),n.append(a);var o=t.pages_parm,i=template("page-item",o),r=$("#infos-page-box");r.empty(),r.append(i),$("#info-total_count").html(t.count),l.listenPageEvent()}}})})},MemberInfo.prototype.downMembeInfoEvent=function(){$("#btnExport").click(function(){var e=$("#ipt_add_time").val();e?window.open("/member/downinfo/?date="+e):layer.msg("请选择时间",{icon:2,time:1e3})})},MemberInfo.prototype.listenPageEvent=function(){var l=this;$(".page-btn").click(function(){var e=$(this).attr("data-p");e&&(console.log(l.queryUser,l.queryDate),stockajax.get({url:"/member/infolist/",data:{username:l.queryUser,date:l.queryDate,p:e},success:function(e){if(200===e.code){var t=e.data,a=template("info-item",{data:t.data}),n=$(".info-tbody");n.empty(),n.append(a);var o=t.pages_parm,i=template("page-item",o),r=$("#infos-page-box");r.empty(),r.append(i),$("#info-total_count").html(t.count),l.listenPageEvent()}}}))})},MemberInfo.prototype.run=function(){this.addMembeInfoEvent(),this.downMembeInfoEvent(),this.inquireBtnEvent(),this.listenPageEvent()};