function Auth(){this.errorTips=$("#error_tips"),this.errorTips.hide(),this.imageCodeId=""}Auth.prototype.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},Auth.prototype.generateUUID=function(){var n=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(n+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:3&t|8).toString(16)})},Auth.prototype.generateImageCode=function(){var e=this,t=e.imageCodeId;e.imageCodeId=e.generateUUID(),$("#imgshow").attr("src","/system/img_captcha/?p="+t+"&c="+e.imageCodeId)},Auth.prototype.listCaptchaUpdate=function(){var e=this;$("#kanbuq").click(function(){e.generateImageCode()})},Auth.prototype.tipsShow=function(e){this.errorTips.text(e),this.errorTips.show().delay(2e3).fadeOut()},Auth.prototype.listenSignupEvent=function(){var a=this;$("#btn-Login").click(function(){var e=$("#user").val(),t=$("#pass").val(),n=$("#imgcode").val();return e?t?n?(a.errorTips.hide(),void stockajax.post({url:"/system/login/",data:{username:e,password:t,img_captcha:n,img_code_id:a.imageCodeId},success:function(e){if(200===e.code){var t=a.getUrlParam("next");window.location.href=t||"/system/index/"}}})):(a.tipsShow("请输入验证码"),null):(a.tipsShow("请输入密码"),null):(a.tipsShow("请输入用户名"),null)})},Auth.prototype.updatePasswordEvent=function(){$("#change-pwd-btn").click(function(){var e=$("#old_pass").val(),t=$("#password").val(),n=$("#password_confirm").val();e?t&&n?n!==t?layer.msg("两次输入的密码不一致",{icon:2,time:1e3}):stockajax.post({url:"/system/changepwd/",data:{oldpwd:e,newpwd1:t,newpwd2:n},success:function(e){200===e.code&&layer.msg("修改登录密码成功",{icon:1,time:1e3},function(){window.location.href="/system/login/"})}}):layer.msg("请输入新的登录密码",{icon:2,time:1e3}):layer.msg("请输入原始登录密码",{icon:2,time:1e3})})},Auth.prototype.addUserEvent=function(){var l=$("#add-username"),d=$("#add-password"),u=$("#add-password-confirm"),p=$("#add-user-desc");$("#add-user-btn").click(function(){l.val(""),d.val(""),u.val(""),p.val(""),layer.open({type:1,title:"添加用户",closeBtn:1,anim:2,area:["800px","400px"],shadeClose:!0,content:$("#add-user-tan")})}),$("#add-user-submit").click(function(){var e=l.val(),t=d.val(),n=u.val(),a=p.val(),o=$(".add-user-enable"),s=$(".add-user-disable"),i=$("#add-user-select-type").val(),r=0,c=0;return e?t&&n?t.length<8||n.length<8?(layer.msg("密码长度不能小于8个字符",{icon:2}),null):n!==t?(layer.msg("两次输入密码不一致",{icon:2}),null):(o.prop("checked")&&(c=1),s.prop("checked")&&(c=0),"2"===i?r=1:"3"===i&&(r=0),layer.closeAll(),void stockajax.post({url:"/system/sysuser/",data:{username:e,pwd1:t,pwd2:n,desc:a,user_type:r,activation:c},success:function(e){200===e.code&&(layer.closeAll(),layer.msg("添加用户成功!",{icon:1,time:1e3},function(){window.location=window.location.href}))},fail:function(){layer.msg("添加用户失败!",{icon:1,time:1e3})}})):(layer.msg("请输入密码",{icon:2}),null):(layer.msg("请输入用户名",{icon:2}),null)})},Auth.prototype.editUserEvent=function(){var s,e=$("#edit-username"),i=$("#edit-desc"),r=$("#edit-user-select-type"),c=$(".edit-user-enable"),l=$(".edit-user-disable");$(".edit-user-btn").click(function(){$(this).attr("data-user-id");s=$(this).parent("td.brand-manage"),e.text(s.prevAll(".user-name").text()),i.val(s.prevAll(".user-desc").text()),"True"===s.prevAll(".user-type").attr("data-is")?r.val(2):r.val(3),layer.open({type:1,title:"编辑",closeBtn:1,anim:2,area:["800px","400px"],shadeClose:!0,content:$("#add-user-tan-edit")})}),$("#edit-user-submit").click(function(){var e=s.prevAll(".user-id").text(),t=i.val(),n=r.val(),a=0,o=0;c.prop("checked")&&(o=1),l.prop("checked")&&(o=0),"2"===n?a=1:"3"===n&&(a=0),console.log(e,t,a,o),layer.closeAll(),stockajax.put({url:"/system/sysuser/",data:{user_id:e,desc:t,user_type:a,activation:o},success:function(e){200===e.code&&(layer.closeAll(),layer.msg("编辑成功!",{icon:1,time:1e3},function(){window.location=window.location.href}))},fail:function(){layer.msg("编辑失败!",{icon:1,time:1e3})}})})},Auth.prototype.passwordEditEvent=function(){var n,t;$(".pwd-user-btn").click(function(){var e=$(this);t=e.parent("td.brand-manage"),n=e.attr("data-user-id"),$("#change-pwd-username").html(t.prevAll(".user-name").text()),layer.open({type:1,title:"修改密码",closeBtn:1,anim:2,area:["800px","400px"],shadeClose:!0,content:$("#add-user-tan-pwd")})}),$("#pwd-user-submit").click(function(){layer.closeAll();var e=$("#change-pwd-password").val(),t=$("#change-pwd-password_confirm").val();e===t?stockajax.post({url:"/system/changeallpwd/",data:{user_id:n,newpwd1:e,newpwd2:t},success:function(e){200===e.code&&layer.msg("密码修改成功!",{icon:1,time:1e3},function(){window.location=window.location.href})},fail:function(){layer.msg("密码修改失败!",{icon:1,time:1e3})}}):layer.msg("两次输入的密码不一致",{icon:1,time:1e3})})},Auth.prototype.delUserEditEvent=function(){$(".del-user-btn").click(function(){var e=$(this).attr("data-user-id");layer.confirm("确定要删除？",{btn:["确定","取消"]},function(){layer.closeAll(),stockajax.delete({url:"/system/sysuser/",data:{user_id:e},success:function(e){200===e.code&&layer.msg("删除成功!",{icon:1,time:1e3},function(){window.location=window.location.href})}})},function(){layer.closeAll()})})},Auth.prototype.run=function(){this.generateImageCode(),this.listCaptchaUpdate(),this.listenSignupEvent(),this.updatePasswordEvent(),this.addUserEvent(),this.editUserEvent(),this.passwordEditEvent(),this.delUserEditEvent()},$(function(){(new Auth).run()});